<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>CD Plan for Rails Project</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>CD Plan</h1>
					<h3>For a Rails Project</h3>
					<!-- <h3>Advanced Ruby Expert Homework</h3> -->
					<p>
						<small>From <a href="https://github.com/Jeanne-WN">Wang Ni</a></small>
					</p>
				</section>

				<section>
					<section>
						<h3>Continous Delivery</h3>

					</section>
					<section>
						<img src="images/go-plan.png" width="900" style="border: none; box-shadow: none;"/>
					</section>
					<section>
						<p>
							<span class='fragment roll-in' style='color: #42affa;font-size: 70%;padding-right: 10px;'>Test Automation</span>
							<span class='fragment roll-in' style='color: #42affa;font-size: 70%;padding-right: 10px;'>Revision Control</span>
							<span class='fragment roll-in' style='color: #42affa;font-size: 70%;padding-right: 10px;'>CI</span>
							<span class='fragment roll-in' style='color: #42affa;font-size: 70%;padding-right: 10px;'>IT Automation</span>
							<span class='fragment roll-in' style='color: #42affa;font-size: 70%;padding-right: 10px;'>One-click Deployment</span>
						</p>
					</section>
					<section>
						<table>
							<thead>
								<tr>
									<th></th>
									<th style='color: #42affa;border-color:white;'>Tool Options</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>Test Automation</td>
									<td>a lot ...</td>
								<tr>
								<tr>
									<td>Revision Control</td>
									<td>Git, SVN</td>
								<tr>
								<tr>
									<td>CI</td>
									<td>Go, Snap CI, Jenkins, Bamboo, Travis</td>
								<tr>
								<tr>
									<td>IT Automation</td>
									<td>Ansible, Chef, Puppet, Shell Script</td>
								<tr>
								<tr>
									<td>One-click Deployment</td>
									<td>Capistrano, IT Automations</td>
								<tr>
							</tbody>
						</table>
					</section>
					<section>
						<p>
							招财猫
						</p>
						<p>
							<a href="http://join.thoughtworkschina.com/">http://join.thoughtworkschina.com/</a>
						</p>
						<p style='padding-top: 100px;'>
							<span class='fragment roll-in' style='color: #42affa;font-size: 80%;padding-right: 10px;'>Rails</span>
							<span class='fragment roll-in' style='color: #42affa;font-size: 80%;padding-right: 10px;'>Mysql</span>
							<span class='fragment roll-in' style='color: #42affa;font-size: 80%;padding-right: 10px;'>Memcached</span>
							<span class='fragment roll-in' style='color: #42affa;font-size: 80%;padding-right: 10px;'>Git</span>
						</p>
					</section>
					<section>
							<span style='color: #42affa;font-size: 70%;padding-right: 10px;text-decoration:line-through;font-style:italic;'>Test Automation</span>
							<span style='color: #42affa;font-size: 70%;padding-right: 10px;text-decoration:line-through;font-style:italic;'>Revision Control</span>
							<span style='color: #42affa;font-size: 70%;padding-right: 10px;'>CI</span>
							<span style='color: #42affa;font-size: 70%;padding-right: 10px;'>IT Automation</span>
							<span style='color: #42affa;font-size: 70%;padding-right: 10px;'>One-click Deployment</span>
					</section>
					<section>
						<img src="images/go-logo.png" width="300" style="border: none; box-shadow: none;"/>
					</section>
					<section>
						<img src="images/ansible-logo.png" width="200" style="background:none;border: none; box-shadow: none;"/>
					</section>
					<section>
						<img src="images/capistrano-logo.png" width="300" style="background:none;border: none; box-shadow: none;"/>
					</section>
				</section>

				<section>
					<section>
						<h3>Setup CI</h3>
					</section>
					<section>
						<img src="images/go-ci.png" width="900" style="border: none; box-shadow: none;"/>
						<p>
							How Go CI works
						</p>
					</section>
					<section>
						<p>
							What do we need for setup a Go CI ?
						</p>
						<ul style="font-size: 80%">
								<li class='fragment roll-in' style="color:#42affa;">Go Server</li>
								<li class='fragment roll-in' style="color:#42affa;">Go Agent(s)</li>
								<li class='fragment roll-in' style="color:#42affa;">Pipeline</li>
								<!-- <li class='fragment roll-in' style="color:#42affa;">Go Agent(s) preparation</li> -->
								<!-- <li class='fragment roll-in' style="color:#42affa;">Necessary accesses for Go Agent</li> -->
						</ul>
					</section>
					<section>
						<p>
							Conceptions
						</p>
					</section>
					<section>
						<p>
							<span style='color:#42affa;'>Pipeline, Stage, Job, Task</span>
						</p>
					</section>
					<section>
						<img src="images/go-pipeline.png" width="900" style="border: none; box-shadow: none;"/>
					</section>
					<section>
						<img src="images/go-stage-job.png" width="300" style="border: none; box-shadow: none;"/>
					</section>
					<section>
						<img src="images/go-tasks.png" width="900" style="border: none; box-shadow: none;"/>
					</section>
					<section>
						<img src="images/go-definitions.png" width="900" style="border: none; box-shadow: none;"/>
					</section>
					<section>
						<p>
							Agent as <span style='color:#42affa;'>Resources</span>
						</p>
					</section>
					<section>
						<img src="images/go-resource.png" width="700" style="border: none; box-shadow: none;"/>
					</section>
					<section>
						<p>
							<span style='color:#42affa;'>Environments</span>
						</p>
					</section>
					<section>
						<img src="images/go-env.png" width="700" style="border: none; box-shadow: none;"/>
					</section>
					<section>
						<p>
							<span style='color:#42affa;'>Artifacts</span>
						</p>
					</section>
					<section>
						<img src="images/go-artifacts-1.png" width="800" style="border: none; box-shadow: none;"/>
					</section>
					<section>
						<img src="images/go-artifacts-2.png" width="300" style="border: none; box-shadow: none;"/>
					</section>
					<section>
						<p>
							What else ?
						</p>
					</section>
					<section>
						<p>
							Go Agent(s) preparation
						</p>
						<p style='color:#42affa; font-size: 90%;'>
							IT Automation
						</p>
					</section>
					<section>
						<p>
							Necessary <span style='color:#42affa;'>accesses</span> for Go Agent
						</p>
					</section>
					<section>
						<p>
							Git
						</p>
					</section>
					<section>
						<p>
							And ...
						</p>
					</section>
					<section>
						<img src="images/go-deploy.png" width="900" style="border: none; box-shadow: none;"/>
						<p class='fragment roll-in'>One-click Deployment</p>
					</section>
					<section>
						<p>
							Tips
						</p>
					</section>
					<section>
						<p>
							A <span style='color:#42affa;'>new</span> Git account for Go Agent(s)
						</p>
					</section>

					<section>
						<a href='http://www.go.cd'>http://www.go.cd</a>
						<!-- <a href='http://www.go.cd/documentation/user/current/navigation'>http://www.go.cd/documentation/user/current/navigation</a> -->
					</section>

				</section>

				<section>
					<section>
						<h3>IT Automation</h3>
					</section>
					<section>
						<p>
							What is it?
						</p>
					</section>
					<section>
						<p>
							Things need to figure out before start
						</p>
						<ul style="font-size: 80%">
							<li class='fragment roll-in' style="color:#42affa;">Linux Distribution</li>
							<li class='fragment roll-in' style="color:#42affa;">Accesses</li>
							<li class='fragment roll-in' style="color:#42affa;">Requirements</li>
						</ul>
					</section>
					<section>
						<ul style="font-size: 80%">
							<li class='fragment roll-in' style="color:#42affa;">Ubuntu 12.04.5 LTS</li>
							<li class='fragment roll-in' style="color:#42affa;">twer@10.17.7.18:22</li>
							<li class='fragment roll-in' style="color:#42affa;">Ruby 2.1, Nginx, Memcached, Mysql 5.4, Git</li>
						</ul>
					</section>
					<section>
						<p>
							Steps ?
						</p>
					</section>
					<section>
						<p style='font-size: 80%;'>
							<span style='color:#42affa;font-size: 120%'>Step 1: </span>Connect to machine
						</p>
						<p class='fragment roll-in' style='color: #42affa;font-size: 90%;'>SSH</p>
					</section>
					<section>
						<p>
							Things need to know about SSH
						</p>
						<ul style="font-size: 80%">
							<li class='fragment roll-in' style="color:#42affa;">SSH key pair</li>
							<li class='fragment roll-in' style="color:#42affa;">port</li>
							<li class='fragment roll-in' style="color:#42affa;">known_hosts</li>
							<li class='fragment roll-in' style="color:#42affa;">authorized_keys</li>
							<li class='fragment roll-in' style="color:#42affa;">config</li>
						</ul>
					</section>
					<section>
						<img src="images/ssh-config.png" width="500" style="background:none;border: none; box-shadow: none;"/>
					</section>
					<section>
						<p style='font-size: 80%;'>
							<span style='color:#42affa;font-size: 120%'>Step 2: </span>Install packages
						</p>
						<p class='fragment roll-in' style='color: #42affa;font-size: 80%;'>yum, apt-get, dpkg ...</p>
					</section>
					<section>
						<p>
							Authorization - sudo ?
						</p>
					</section>
					<section>
						<p>
							Package Repositories
						</p>
					</section>
					<section>
						<p style='font-size: 80%;'>
							<span style='color:#42affa;font-size: 120%'>Step 3: </span>Configurations / Customization
						</p>
						<p class='fragment roll-in' style='color: #42affa;font-size: 80%;'>where? how?</p>
					</section>
					<section>
						<p style='font-size: 80%;'>
							/etc, /etc/init.d/, /opt, /usr, /var
						</p>
					</section>
					<section>
						<p style='font-size: 80%;'>
							$PATH, ln, chmod, chown ...
						</p>
						<p class='fragment roll-in' style='color: #42affa;font-size: 80%;'>Copy Templates</p>
					</section>
					<section>
						<p>
							Don't forget <span style='color:#42affa;'>restart service</span>.
						</p>
					</section>
					<section>
						<img src="images/ansible-logo.png" width="200" style="background:none;border: none; box-shadow: none;"/>
					</section>
					<section>
						<p>
							<span style='color:#42affa;'>Be careful</span> when reusing existing resources
						</p>
					</section>
				</section>

				<section>
					<section>
						<h3>One-click Deployment</h3>
					</section>
					<section>
						<p>
							What is it?
						</p>
					</section>
					<section>
						<p>
							Things need to figure out before start
						</p>
						<ul style="font-size: 80%">
							<li  style="color:#42affa;">Linux Distribution</li>
							<li  style="color:#42affa;">Accesses</li>
							<li  style="color:#42affa;">Requirements</li>
						</ul>
					</section>
					<section>
						<p>
							Requirments
						</p>
						<ul style="font-size: 80%">
							<li class='fragment roll-in' style="color:#42affa;">Nginx as HTTP Server</li>
							<li class='fragment roll-in' style="color:#42affa;">Unicorn as App Server</li>
							<li class='fragment roll-in' style="color:#42affa;">DB Migration</li>
							<li class='fragment roll-in' style="color:#42affa;">0 Downtime</li>
							<li class='fragment roll-in' style="color:#42affa;">Deploying to staging in every build</li>
						</ul>
					</section>
					<section>
						<p>
							Steps ?
						</p>
					</section>
					<section>
						<img src="images/capistrano-logo.png" width="250" style="background:none;border: none; box-shadow: none;"/>
						<p>
							<ul style="font-size: 70%;">
								<li class='fragment roll-in'>SSH to Server</li>
								<li class='fragment roll-in'>Pull code</li>
								<li class='fragment roll-in'>Bundle install</li>
								<li class='fragment roll-in'>Precompile assets</li>
								<li class='fragment roll-in'>Migrate DB</li>
								<li class='fragment roll-in'>Restart App Server</li>
							</ul>
						</p>
					</section>
					<section>
						<img src="images/cap-setup-1.png" width="550" style="background:none;border: none; box-shadow: none;"/>
						<img src="images/cap-setup-3.png" width="400" style="background:none;border: none; box-shadow: none;"/>
						<p style='font-size: 70%'>
							Telling Capistrano what to do
						</p>
					</section>
					<section>
						<p>
							But ...
						</p>
					</section>
					<section>
						<p style='font-size: 80%;'>
							How ?
						</p>
						<p>
							<ul style="font-size: 70%;color:#42affa;">
								<li class='fragment roll-in'>Go agent connects to Staging</li>
								<li class='fragment roll-in'>Staging connects to Github</li>
							</ul>
						</p>
					</section>
					<section>
						<p style='font-size: 80%;'>
							<span style='color:#42affa;font-size: 100%'>SSH agent forward: </span>ssh-agent, ssh-add
						</p>
					</section>
					<section>
						<p style='font-size: 70%;'>
							1. Add go-agent's <span style='color:#42affa;'>ssh public key</span> to staging's <span style='color:#42affa;'>authorized_keys</span>
						</p>
					</section>
					<section>
						<img src="images/cap-setup-2.png" width="400" style="background:none;border: none; box-shadow: none;"/>
						<p style='font-size: 60%;'>
							2. Config Capistrano
						</p>
					</section>
					<section>
						<img src="images/cap-setup-4.png" width="400" style="background:none;border: none; box-shadow: none;"/>
						<p style='font-size: 60%;'>
							3. Create deploy.sh for CI
						</p>
					</section>
					<section>
						<p>
							Others ...
						</p>
					</section>
					<section>
						<p>
							<ul style="font-size: 70%;color:#42affa;">
								<li>Init DB</li>
								<li>Directory permission</li>
								<li>Nginx configuration</li>
								<li>Unicorn configuration</li>
								<li>Restart Service</li>
							</ul>
						</p>
					</section>
				</section>

				<section>
					<h4>Thank you.</h4>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
